---
title: 网易新闻瘦身实践.md
date: 2017-07-06 09:55:07
tags: 瘦身
categories: Android
---
随着业务的不断增长，网易新闻客户端已经承载了过多的功能，不仅仅是一个新闻资讯的app，而是称了公司各个业务线的载体。因此，体积增长的问题就暴露了除了。体积最大时达到了30M，这对一个android应用级别的app来说算是非常大的了。于是不得不把瘦身的工作提到日程上。
### 分析apk，查看个模块的占比
这一块目前来说还是非常方便的，直接使用android studio提供的apk分析工具，将自己的apk拉入进去，查看一下包体积的状况即可。
![](/.title/apkanalyze.jpg)
如上图所示，可以看到主要的体积占用是再lib下的so库， 资源文件和dex这三个部分。于是我们根据分析采取了一下措施。
### 实施瘦身
#### 资源图片的压缩
对于资源图片，之前一直使用的是为进行压缩的png图片。我们对比了目前比较好的图片压缩工具。
1. [https://tinypng.com](https://tinypng.com/  )  在线的压缩工具，免费版对图片压缩有大小和size限制。但是实践过程中我们发现这个工具对某些图片压缩不成功时竟然出现了比原始图片大的状况。
2. mac下的压缩工具ImageOptim， 此工具的压缩效果也是不错的，只不过这是一款软件，我们只能每次进行收工操作，集成度不高
那么有没有一款工具能做到效果好，同时可集成度高，不用我们每次进行收工操作的。
最后，我们找到了
#### 本地图片Webp化
对于压缩过的图片，其实效果已经很好了，但是我们考虑还有没有再进行压缩的方案。于是，我们考虑了webp格式的图。对于webp格式的图片，虽然再android上使用还是有很大坑的。第一，系统版本的支持，4.0以上才支持webp格式； 第二， 不同版本的支持格式不一样， 4.1以上的系统才支持含透明的的webp图片。
由于上边这些坑，我们不得不
